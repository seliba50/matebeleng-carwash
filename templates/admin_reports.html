{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <h2><i class="fas fa-chart-bar"></i> Admin Reports & Analytics</h2>
            <p class="text-muted">Comprehensive system overview and reporting tools</p>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card text-center bg-primary text-white">
                <div class="card-body">
                    <h3>{{ user_stats.total_users or 0 }}</h3>
                    <p class="mb-0">Total Users</p>
                    <small>{{ user_stats.active_users or 0 }} active</small>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card text-center bg-success text-white">
                <div class="card-body">
                    <h3>{{ quiz_stats.total_quizzes or 0 }}</h3>
                    <p class="mb-0">Total Quizzes</p>
                    <small>{{ quiz_stats.active_quizzes or 0 }} active</small>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card text-center bg-info text-white">
                <div class="card-body">
                    <h3>{{ resource_stats.total_resources or 0 }}</h3>
                    <p class="mb-0">Learning Resources</p>
                    <small>{{ resource_stats.active_resources or 0 }} active</small>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card text-center bg-warning text-white">
                <div class="card-body">
                    <h3>{{ certificate_stats.total_certificates or 0 }}</h3>
                    <p class="mb-0">Certificates</p>
                    <small>{{ certificate_stats.users_with_certificates or 0 }} users</small>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Quick Actions -->
        <div class="col-md-4 mb-4">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-rocket"></i> Quick Actions</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('admin_users') }}" class="btn btn-outline-primary text-start">
                            <i class="fas fa-users"></i> Manage Users
                        </a>
                        <a href="{{ url_for('admin_analytics') }}" class="btn btn-outline-success text-start">
                            <i class="fas fa-chart-line"></i> View Analytics
                        </a>
                        <a href="{{ url_for('system_logs') }}" class="btn btn-outline-info text-start">
                            <i class="fas fa-clipboard-list"></i> System Logs
                        </a>
                        <a href="{{ url_for('admin_quizzes') }}" class="btn btn-outline-warning text-start">
                            <i class="fas fa-question-circle"></i> Manage Quizzes
                        </a>
                    </div>
                </div>
            </div>

            <!-- Export Options -->
            <div class="card mt-4">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-download"></i> Export Reports</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('export_report', report_type='users') }}" class="btn btn-outline-success text-start">
                            <i class="fas fa-users"></i> Export Users
                        </a>
                        <a href="{{ url_for('export_report', report_type='quiz_attempts') }}" class="btn btn-outline-success text-start">
                            <i class="fas fa-question-circle"></i> Export Quiz Attempts
                        </a>
                        <a href="{{ url_for('export_report', report_type='certificates') }}" class="btn btn-outline-success text-start">
                            <i class="fas fa-award"></i> Export Certificates
                        </a>
                        <a href="{{ url_for('export_report', report_type='learning_progress') }}" class="btn btn-outline-success text-start">
                            <i class="fas fa-book-open"></i> Export Learning Progress
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="col-md-8 mb-4">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="fas fa-history"></i> Recent System Activity</h5>
                </div>
                <div class="card-body">
                    {% if recent_activity %}
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>User</th>
                                    <th>Activity</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for activity in recent_activity %}
                                <tr>
                                    <td>
                                        <small>{{ activity.created_at.strftime('%Y-%m-%d %H:%M') }}</small>
                                    </td>
                                    <td>
                                        {% if activity.username %}
                                            <span class="badge bg-primary">{{ activity.username }}</span>
                                        {% else %}
                                            <span class="badge bg-secondary">System</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span class="badge bg-{% if activity.activity_type == 'login' %}success{% elif activity.activity_type == 'failed_login' %}danger{% else %}info{% endif %}">
                                            {{ activity.activity_type }}
                                        </span>
                                    </td>
                                    <td>
                                        <small>{{ activity.description }}</small>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p class="text-muted text-center">No recent activity</p>
                    {% endif %}
                </div>
            </div>

            <!-- System Statistics -->
            <div class="card mt-4">
                <div class="card-header bg-warning text-white">
                    <h5 class="mb-0"><i class="fas fa-chart-pie"></i> System Statistics</h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-4">
                            <h5>{{ user_stats.active_30_days or 0 }}</h5>
                            <small class="text-muted">Active Users (30 days)</small>
                        </div>
                        <div class="col-4">
                            <h5>{{ "%.1f"|format(user_stats.avg_logins_per_user or 0) }}</h5>
                            <small class="text-muted">Avg Logins/User</small>
                        </div>
                        <div class="col-4">
                            <h5>{{ quiz_stats.categories_used or 0 }}</h5>
                            <small class="text-muted">Categories Used</small>
                        </div>
                    </div>
                    <div class="row text-center mt-3">
                        <div class="col-4">
                            <h5>{{ resource_stats.resource_types or 0 }}</h5>
                            <small class="text-muted">Resource Types</small>
                        </div>
                        <div class="col-4">
                            <h5>{{ "%.1f"|format(certificate_stats.avg_certificate_score or 0) }}%</h5>
                            <small class="text-muted">Avg Certificate Score</small>
                        </div>
                        <div class="col-4">
                            <h5>{{ user_stats.total_users or 0 }}</h5>
                            <small class="text-muted">Total Registered</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}